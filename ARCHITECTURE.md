# Stock Advisor Architecture

## 1. Overview
**Stock Advisor**??FastAPI 湲곕컲???ㅼ떆媛?二쇱떇 遺꾩꽍 諛??ы듃?대━??愿由??쒖뒪?쒖엯?덈떎.
誘멸뎅/?쒓뎅 二쇱떇???ㅼ떆媛??쒖꽭 紐⑤땲?곕쭅, DCF(?꾧툑?먮쫫?좎씤踰? 媛移섑룊媛, 洹몃━怨??ъ슜???ы듃?대━???섏씡瑜?遺꾩꽍???섑뻾?섎ŉ Slack?쇰줈 ?뚮┝???꾩넚?⑸땲??

## 2. Service Layer Structure

?꾨줈?앺듃??`services/` ?붾젆?좊━ ?댁쓽 ?꾨Ц?붾맂 ?쒕퉬???대옒?ㅻ뱾濡?援ъ꽦?섏뼱 ?덉뒿?덈떎.

```mermaid
graph TD
    Main[main.py (FastAPI)] --> Scheduler[SchedulerService]
    Main --> Portfolio[PortfolioService]
    Main --> Alert[AlertService]
    
    Scheduler -- 1. 二쇨린???ㅽ뻾 --> Data[DataService]
    Scheduler -- 2. 媛移섑룊媛 --> Financial[FinancialService]
    Scheduler -- 3. ?뚮┝ 泥댄겕 --> Alert
    Scheduler -- 4. ?먯궛 遺꾩꽍 --> Portfolio
    
    Portfolio --> Data[DataService]
    Portfolio --> Ticker[TickerService]
    
    Financial --> Data
```

### ?㎥ Core Services

#### 1. `SchedulerService` (The Heartbeat)
諛깃렇?쇱슫?쒖뿉??二쇨린?곸씤 ?묒뾽??珥앷큵?⑸땲??
- **`start()`**: ?ㅼ?以꾨윭 珥덇린??諛??묒뾽 ?깅줉.
- **`update_prices()`** (1遺?媛꾧꺽): Top 20 諛?愿??醫낅ぉ???ㅼ떆媛??쒖꽭, RSI, EMA ?낅뜲?댄듃.
- **`check_portfolio_hourly()`** (1?쒓컙 媛꾧꺽): **Webull ?ㅽ???* ?깅씫瑜?Pre-market 諛섏쁺)濡??ы듃?대━???꾩닔 議곗궗 諛??곸듅 醫낅ぉ 由ы룷???앹꽦.
- **`update_dcf_valuations()`** (30遺?媛꾧꺽): DCF ?곸젙二쇨? ?ш퀎??

#### 2. `PortfolioService` (Asset Management)
?ъ슜?먯쓽 ?먯궛??愿由ы빀?덈떎.
- **`parse_excel()`**: ?묒? ?뚯씪???뚯떛?섏뿬 蹂댁쑀 醫낅ぉ(Ticker, ?섎웾, 留ㅼ닔媛) 濡쒕뱶.
- **`load_portfolio()` / `save_portfolio()`**: JSON ?뚯씪濡??먯궛 ?곗씠???곴뎄 ???
- **`analyze_portfolio()`**: ?꾩옱媛 湲곕컲 ?섏씡瑜?諛??뱁꽣蹂?鍮꾩쨷 遺꾩꽍.

#### 3. `AlertService` (Notification)
Slack ?뚮┝??愿由ы빀?덈떎. ?쒕쾭 遺??遺꾩궛???꾪빐 **?湲곗뿴(Queue)** 諛⑹떇???ъ슜?⑸땲??
- **`check_and_alert()`**: RSI 怨쇰ℓ??怨쇰ℓ?? DCF ??됯?, 吏吏??EMA) ?뚰뙆 ?щ? ?먮떒.
- **`send_slack_alert()`**: ?뚮┝ 硫붿떆吏瑜?硫붾え由????湲곗뿴(`_pending_alerts`)??異붽?.
- **`get_pending_alerts()`**: ?湲?以묒씤 ?뚮┝??諛섑솚?섍퀬 鍮꾩? (API polling??.

#### 4. `FinancialService` (Valuation)
湲곗뾽????붾찘?몄쓣 遺꾩꽍?⑸땲??
- **`get_dcf_data()`**: FCF(?먯쑀?꾧툑?먮쫫), Beta, ?깆옣瑜??곗씠???섏쭛.
- **`validate_dcf()`**: ?곗텧??DCF ?곸젙媛? ?꾩옱媛瑜?鍮꾧탳?섏뿬 ?좊ː??High/Medium/Low) ?됯?.

#### 5. `DataService` & `TickerService` (Infra)
- **`DataService`**: `yfinance`, `FinanceDataReader`瑜??듯빐 OHLCV 諛??ㅼ떆媛??쒖꽭 議고쉶.
- **`TickerService`**: ?쒓뎅??醫낅ぉ紐??쇱꽦?꾩옄) ???곗빱(005930) 蹂??

## 3. Data Flow (Notification Loop)

1.  **Detection**: `SchedulerService`媛 ?쒖꽭 蹂?숈쓣 媛먯??섍퀬 `AlertService`???뚮┝ ?붿껌.
2.  **Queueing**: `AlertService`??硫붿떆吏瑜?利됱떆 蹂대궡吏 ?딄퀬 **Queue**???곸옱.
3.  **Polling**: ?몃? ?먯씠?꾪듃(OpenClaw Cron) ?먮뒗 ?대씪?댁뼵?멸? `GET /alerts/pending` ?몄텧.
4.  **Delivery**: ?섏떊??硫붿떆吏瑜??ㅼ젣 Slack 梨꾨꼸濡??꾩넚.

## 4. Key Features
- **Webull-Style Pre-market Logic**: ?꾨━留덉폆 ?깅씫瑜?怨꾩궛 ??`(?꾩옱媛 - ?뺢퇋??醫낃?) / ?뺢퇋??醫낃?` 怨듭떇???ъ슜?섏뿬 ?깃낵 ?숈씪??寃쏀뿕 ?쒓났.
- **Hybrid Data Source**: 誘멸뎅 二쇱떇? `yfinance`, ?쒓뎅 二쇱떇? `FinanceDataReader` 諛?`Naver Finance` ?щ·留??쇱슜.
